/* =============================================================================
   
   üìÅ HEADER.CSS ‚Äî –®–∞–ø–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   
   –ß—Ç–æ –∑–¥–µ—Å—å:
   - Header structure (#app-header, .header-inner)
   - Logo, title
   - Universal buttons (.icon-btn)
   - Inputs (quick-add, search)
   - Search lens & trigger
   - Burger button & popover
   - Search popover (mobile)
   - Modal forms (Save As, Snapshot, Workspaces)
   - Quick Add target picker
   - Responsive breakpoints
   
   ============================================================================= */

/* === HEADER BASE === */
#app-header {
  display: block;
  position: sticky;
  top: var(--safe-area-top, 0px);
  z-index: var(--z-sticky);
  max-width: none;
  width: 100%;
  margin: 0;
  padding: 6px 2px;
  border-bottom: 1px solid var(--header-border);
  background: var(--header-bg);
  color: var(--header-fg);

  /* –í–Ω—É—Ç—Ä–∏ —à–∞–ø–∫–∏ —Ç–µ–∫—Å—Ç = header-fg */
  --text: var(--header-fg);
  --input-bg: transparent;
  --input-text: var(--header-fg);
  --input-border: var(--header-fg);
  --input-placeholder: color-mix(in oklab, var(--header-fg) 85%, transparent);
  --input-focus-bg: color-mix(in oklab, var(--header-fg) 12%, transparent);
  --input-focus-border: var(--header-fg);
}

/* –ü–æ–¥–ª–æ–∂–∫–∞ –ø–æ–¥ safe-area (–≤—ã—Ä–µ–∑ —ç–∫—Ä–∞–Ω–∞) */
#app-header::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--safe-area-top);
  background: var(--header-bg);
  z-index: calc(var(--z-sticky) - 1);
  pointer-events: none;
}

/* === LAYOUT === */
#app-header .header-inner {
  margin-inline: auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--header-gap, 8px);
}

.header-left {
  display: flex;
  align-items: center;
  gap: 1px;
  flex: 0 0 auto;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1 1 auto;
  min-width: 0;
  flex-wrap: nowrap;
  overflow: visible;
}

/* –ö–Ω–æ–ø–∫–∏ –ø–æ–≤–µ—Ä—Ö –∏–Ω–ø—É—Ç–æ–≤ (–¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ stacking) */
.header-right .icon-btn {
  position: relative;
  z-index: 20;
}

.header-right .input-wrap {
  position: relative;
  z-index: 10;
}

/* === LOGO / TITLE === */
.logo-btn,
.app-title {
  color: var(--header-fg);
}

.logo-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  border: 0;
  background: transparent;
  cursor: pointer;
  padding: 4px 6px;
}

.logo-btn:hover {
  opacity: 0.8;
}

.app-title {
  font-weight: 600;
  font-size: 1.1em;
}

/* === UNIVERSAL ICON BUTTON === */
.icon-btn {
  flex: 0 0 auto;
  width: 30px;
  height: 30px;
  padding: 4px;
  border: 1px solid var(--input-border);
  border-radius: var(--radius-sm);
  background: var(--input-bg);
  color: var(--input-text);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.icon-btn:hover {
  background: var(--surface-2);
  border-color: var(--accent);
}

/* === INPUTS (QUICK-ADD, SEARCH) === */
.input-wrap {
  position: relative;
  flex: 0 1 auto;
  min-width: 0;
}

.input-wrap input {
  width: 100%;
  min-height: 32px;
  padding: 8px 8px 8px 12px;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  color: var(--input-text);
  border-radius: var(--radius-sm);
  box-sizing: border-box;
  caret-color: var(--accent);
}

.input-wrap input::placeholder {
  color: var(--input-placeholder);
  opacity: 1;
}

.input-wrap input:focus {
  outline: none;
  background: var(--input-focus-bg);
  border-color: var(--input-focus-border);
  box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 30%, transparent);
}

/* –°—É—Ñ—Ñ–∏–∫—Å –∏–Ω–ø—É—Ç–∞ (–∏–∫–æ–Ω–∫–∞ —Å–ø—Ä–∞–≤–∞) */
.input-wrap .input-suffix {
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 26px;
  height: 26px;
  border: none;
  background: transparent;
  color: var(--input-text);
  cursor: pointer;
}

.input-wrap .input-suffix:hover {
  background: var(--surface-2);
  border-radius: 50%;
}

/* –®–∏—Ä–∏–Ω—ã */
.header-right .quick-add {
  max-width: 360px;
}

.header-right .search-box {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  flex: 0 1 auto;
  max-width: 280px;
  min-width: 200px;
}

#searchInput {
  padding-right: 30px;
  padding-left: 32px;
  min-width: 240px;
}

/* === SEARCH LENS (–ª—É–ø–∞ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞) === */
.header-right .search-box::before {
  content: "";
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  pointer-events: none;
  background: color-mix(in oklab, var(--header-fg) 85%, transparent);
  -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" stroke="black" fill="none" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7" stroke-width="2"/><path d="M20 20 L16.65 16.65" stroke-width="2" stroke-linecap="round"/></svg>')
    center / contain no-repeat;
  mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" stroke="black" fill="none" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7" stroke-width="2"/><path d="M20 20 L16.65 16.65" stroke-width="2" stroke-linecap="round"/></svg>')
    center / contain no-repeat;
}

.header-right .search-box:focus-within::before {
  background: var(--accent);
}

/* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –≤–∏–¥–Ω–æ –ø–æ–ª–µ, –ª—É–ø–∞ —Å–∫—Ä—ã—Ç–∞ */
.header-right .search-box.input-wrap {
  display: inline-flex;
}

.header-right .search-trigger {
  display: none;
}

/* === BURGER BUTTON === */
.header-right .burger-btn {
  margin-left: auto;
  display: none; /* –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ media –Ω–∏–∂–µ */
}

/* === BURGER POPOVER === */
.header-burger-popover[hidden] {
  display: none !important;
}

.header-burger-popover {
  position: fixed;
  right: 12px;
  top: calc(var(--header-h, 56px) + 8px);
  min-width: 260px;
  max-width: min(92vw, 360px);
  padding: 8px;
  border: 1px solid var(--popover-border, var(--header-border));
  border-radius: 12px;
  background: var(--popover-bg);
  color: var(--popover-fg);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.18), 0 2px 6px rgba(0, 0, 0, 0.08);
  z-index: var(--z-popover);
}

.header-burger-popover button[data-act] {
  width: 100%;
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 12px;
  padding: 8px 10px;
  border: 0;
  background: transparent;
  color: inherit;
  font: inherit;
  border-radius: 8px;
  cursor: pointer;
  transition: background var(--dur-1) ease;
}

.header-burger-popover button[data-act]:hover {
  background: var(--menu-hover-bg);
}

.header-burger-popover .mi {
  margin-left: auto;
  display: inline-flex;
  align-items: center;
}

.header-burger-popover .mi svg {
  width: 18px;
  height: 18px;
  stroke: currentColor;
  fill: none;
}

.header-burger-popover hr {
  border: 0;
  height: 1px;
  background: var(--popover-border, var(--header-border));
  margin: 6px 0;
}

/* === SEARCH POPOVER (MOBILE) === */
.header-search-popover {
  position: fixed;
  padding: 0;
  min-width: 0;
  max-width: 100vw;
  background: var(--popover-bg);
  color: var(--popover-fg);
  border: 1px solid var(--popover-border, var(--border));
  border-radius: 10px;
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.18);
  transform: none !important;
  left: 0;
  top: 0;
  right: auto !important;
  bottom: auto !important;
  box-sizing: border-box;
  z-index: var(--z-popover);
}

.header-search-popover[hidden] {
  display: none !important;
}

.header-search-popover input,
#searchInputMobile {
  display: block;
  width: 100%;
  box-sizing: border-box;
  padding: 8px 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--surface-1);
  color: var(--text);
  outline-offset: 2px;
}

/* === MODAL FORMS (Save As / Snapshot / Workspaces) === */
.modal-form {
  display: grid;
  gap: 10px;
}

.modal-form input {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--surface-1);
  color: var(--text);
}

.modal-form .actions,
.modal .modal-actions,
.modal .actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
}

/* –ö–Ω–æ–ø–∫–∏ –º–æ–¥–∞–ª–æ–∫ */
.modal-form .btn,
.modal .modal-actions .btn,
.modal .actions .btn {
  background: var(--surface-1);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 8px;
  padding: 6px 10px;
  cursor: pointer;
}

.modal-form .btn:hover,
.modal .modal-actions .btn:hover,
.modal .actions .btn:hover {
  background: var(--btn-hover-bg);
}

.modal-form .btn.save,
.modal .modal-actions .btn.save,
.modal .actions .btn.save {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
}

.modal-form .btn.save:hover,
.modal .modal-actions .btn.save:hover,
.modal .actions .btn.save:hover {
  filter: brightness(0.96);
}

/* === Sessions modal === */
.sessions-modal {
  display: grid;
  gap: 14px;
  min-width: min(92vw, 560px);
}

.sessions-modal section {
  display: grid;
  gap: 8px;
}

.sessions-modal h3 {
  margin: 0 0 4px;
  font-size: 1rem;
}

.sessions-modal .list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 8px;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ session */
.sessions-modal .row {
  position: relative;
  display: block;
  padding: 12px 116px 12px 12px; /* –∑–∞–ø–∞—Å —Å–ø—Ä–∞–≤–∞ –ø–æ–¥ actions */
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--surface-1);
  color: var(--text);
}

.sessions-modal .info {
  display: grid;
  gap: 4px;
}

.sessions-modal .name {
  font-weight: 600;
  line-height: 1.2;
}

.sessions-modal .meta {
  font-size: 0.85rem;
  color: var(--text-muted);
}

/* –ö–Ω–æ–ø–∫–∏ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É */
.sessions-modal .actions {
  position: absolute;
  right: 10px;
  bottom: 10px;
  display: inline-flex;
  gap: 8px;
}

.sessions-modal .btn {
  background: var(--surface-1);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 8px;
  padding: 6px 10px;
  cursor: pointer;
}

.sessions-modal .btn:hover {
  background: var(--btn-hover-bg);
}

.sessions-modal .btn.save {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
}

.sessions-modal .btn.save:hover {
  filter: brightness(0.96);
}

.sessions-modal hr {
  border: 0;
  height: 1px;
  background: var(--border);
  margin: 6px 0;
}

/* === QUICK ADD: TARGET PICKER === */
.qa-target-btn {
  flex: 0 0 auto;
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  height: var(--control-h, 32px);
  padding: 0 0.75rem;
  border-radius: 10px;
  background: var(--surface-2);
  border: 1px solid var(--hairline);
  color: var(--text);
  cursor: pointer;
  white-space: nowrap;
}

.qa-target-btn:hover {
  background: var(--surface-3, rgba(127, 127, 127, 0.12));
  border-color: var(--hairline);
}

/* –ü–æ–ø–æ–≤–µ—Ä —Å–æ —Å–ø–∏—Å–∫–æ–º —Å–µ–∫—Ü–∏–π */
.qa-target-popover {
  position: fixed;
  z-index: 9999;
  min-width: 220px;
  max-width: min(420px, 90vw);
  max-height: 50vh;
  overflow: auto;
  padding: 6px;
  border-radius: 12px;
  background: var(--bg);
  color: var(--text);
  border: 1px solid var(--hairline);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.22);
}

.qa-target-item {
  width: 100%;
  text-align: left;
  padding: 8px 10px;
  border-radius: 8px;
  background: transparent;
  border: none;
  cursor: pointer;
  color: inherit;
  font: inherit;
}

.qa-target-item:hover,
.qa-target-item:focus {
  outline: none;
  background: color-mix(in oklab, var(--accent) 12%, transparent);
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥ –∏–Ω–ø—É—Ç–æ–º Quick Add */
.qa-target-wrap {
  position: fixed;
  z-index: 9999;
  pointer-events: auto;
}

.qa-inline {
  display: flex;
  margin-bottom: 6px;
}

.qa-inline-btn {
  font: inherit;
  padding: 4px 10px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--text);
  line-height: 1.2;
}

.qa-inline-btn .qa-inline-name {
  font-weight: 600;
}

.qa-target-popover .page-jumper-item {
  width: 100%;
  text-align: left;
  padding: 8px 10px;
  border-radius: 8px;
}

.qa-target-popover .page-jumper-item.is-current {
  outline: 2px solid var(--accent);
  outline-offset: 0;
}

/* === RESPONSIVE === */

/* ‚â§1060px: –ø—Ä—è—á–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É */
@media (max-width: 1060px) {
  .header-right .search-box.input-wrap {
    display: none !important;
  }
  .header-right .icon-btn.search-trigger {
    display: inline-flex !important;
  }
}

/* ‚â§900px: –º–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º */
@media (max-width: 900px) {
  #app-header .primary-save {
    display: none !important;
  }

  .header-right .search-box.input-wrap {
    display: none !important;
  }

  .header-right .quick-add.input-wrap {
    display: inline-flex !important;
    flex: 1 1 auto;
    min-width: 140px;
  }

  /* –°–∫—Ä—ã—Ç—å –≤—Å–µ –∏–∫–æ–Ω–∫–∏‚Ä¶ */
  .header-right .icon-btn {
    display: none !important;
  }

  /* ‚Ä¶–∫—Ä–æ–º–µ –ª—É–ø—ã –∏ –±—É—Ä–≥–µ—Ä–∞ */
  .header-right .icon-btn.search-trigger,
  .header-right .icon-btn.burger-btn {
    display: inline-flex !important;
  }

  .header-right {
    gap: 6px;
  }
}

/* ‚â§768px */
@media (max-width: 768px) {
  #app-header {
    padding: 8px 2px;
  }
  .header-right {
    gap: 4px;
  }
}

@media (max-width: 480px) {
  .header-search-popover {
    max-width: 92vw;
  }

  .sessions-modal .row {
    padding-right: 12px;
  }
  .sessions-modal .actions {
    position: static;
    margin-top: 8px;
    justify-content: flex-end;
    width: 100%;
  }
}

/* === FORCED COMPACT (–∫–æ–≥–¥–∞ Study Panel –æ—Ç–∫—Ä—ã—Ç–∞) === */
body.compact-1060 .header-right .search-box.input-wrap {
  display: none !important;
}

body.compact-1060 .header-right .icon-btn.search-trigger {
  display: inline-flex !important;
}

body.compact-900 #app-header .primary-save {
  display: none !important;
}

body.compact-900 .header-right .search-box.input-wrap {
  display: none !important;
}

body.compact-900 .header-right .quick-add.input-wrap {
  display: inline-flex !important;
  flex: 1 1 auto;
  min-width: 140px;
}

body.compact-900 .header-right .icon-btn {
  display: none !important;
}

body.compact-900 .header-right .icon-btn.search-trigger,
body.compact-900 .header-right .icon-btn.burger-btn {
  display: inline-flex !important;
}

body.compact-900 #app-status {
  gap: 4px;
  padding-inline: 1px;
}

body.compact-900 #app-status .hide-on-mobile {
  display: none;
}

/* Quick-Add: –∑–∞–ø–∞—Å —Å–ø—Ä–∞–≤–∞ –ø–æ–¥ —É–≤–µ–ª–∏—á–µ–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É */
#quickAddInput {
  padding-right: 34px;
}

/* –ò–∫–æ–Ω–∫–∏ –ø–æ–∏—Å–∫–∞ ‚Äî –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
.header-inner .search-wrap .ico-search,
.header-inner .search-wrap .search-clear {
  color: var(--ink-weak);
}

.header-inner .search-wrap:focus-within .ico-search,
.header-inner .search-wrap:focus-within .search-clear {
  color: var(--ink-strong);
}

.header-inner .search-wrap input::placeholder {
  color: var(--ink-weak);
}

.header-inner .search-wrap input:focus {
  color: var(--ink-strong);
}

/* Quick-Add: –±–æ–ª—å—à–æ–π —Ç–æ–Ω–∫–∏–π –ø–ª—é—Å */
#app-header .quick-add .qa-go {
  padding: 0;
  font-size: 0;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: 0;
  background: transparent;
  --plus-size: var(--plus-size-s);
  width: 30px;
  height: 30px;
  color: currentColor;
}
/* ==========================================================================
   HEADER HOTFIX (compact):
   - Quick-Add "+" stays visible when input turns light
   - Search magnifier + clear "x" never turn accent-blue and stay readable
   Works with your existing tokens: --header-*, --input-*, --ink-*
   ========================================================================== */

/* ---------- Quick-Add "+" ---------- */
#app-header .quick-add .qa-go {
  color: var(--ink-strong);
  opacity: 1;
}

/* dark: –ø–ª—é—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç—ë–º–Ω—ã–º –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ (–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –≤ —Ñ–æ–∫—É—Å–µ) */
html[data-theme="dark"]
  #app-header
  .quick-add:has(input:not(:placeholder-shown))
  .qa-go {
  color: var(--header-bg);
}

/* ---------- Header inputs (ensure they use header tokens) ---------- */
#app-header input[type="search"],
#app-header input[type="text"] {
  background: var(--input-bg);
  color: var(--input-text);
  border-color: var(--input-border);
  caret-color: var(--input-text);
}

#app-header input[type="search"]:focus,
#app-header input[type="text"]:focus {
  background: var(--input-focus-bg);
  border-color: var(--input-focus-border);
}

#app-header input::placeholder {
  color: var(--input-placeholder);
}

/* ---------- Search icons: magnifier + clear (custom button) ---------- */
/* We lock icon color to calm placeholder ink (NOT accent), and add a subtle outline
   so it stays visible even if the field background becomes light in some states. */
#app-header .search-box.input-wrap {
  --search-icon-ink: var(--input-placeholder);
}

/* Clear "x" button (your real button, not webkit cancel) */
#app-header .search-box.input-wrap .search-clear {
  color: var(--search-icon-ink) !important;
  opacity: 0.85;
  text-shadow: 0 0 1px rgba(0, 0, 0, 0.6), 0 0 1px rgba(255, 255, 255, 0.35);
}
#app-header .search-box.input-wrap .search-clear:hover {
  opacity: 1;
}

/* Magnifier pseudo-element (prevents ‚Äúblue on focus‚Äù because we override it explicitly) */
#app-header .search-box.input-wrap::before,
#app-header .search-box.input-wrap:focus-within::before {
  background-color: var(--search-icon-ink) !important;
  color: var(--search-icon-ink) !important;
  filter: drop-shadow(0 0 1px rgba(0, 0, 0, 0.6))
    drop-shadow(0 0 1px rgba(255, 255, 255, 0.35));
  opacity: 0.9;
}
/* optional: —á—É—Ç—å —É—Å–∏–ª–∏—Ç—å –∏–∫–æ–Ω–∫–∏, –∫–æ–≥–¥–∞ –ø–æ–∏—Å–∫ "–±–µ–ª—ã–π" (–µ—Å—Ç—å —Ç–µ–∫—Å—Ç) */
#app-header .search-box.input-wrap:has(#searchInput:not(:placeholder-shown)) {
  --search-icon-ink: var(--ink-strong);
}

/* PATCH (dark only): when search input becomes light (has text), make icons dark */
html[data-theme="dark"]
  #app-header
  .search-box.input-wrap:has(#searchInput:not(:placeholder-shown)) {
  --search-icon-ink: var(--header-bg);
}

/* magnifier */
html[data-theme="dark"]
  #app-header
  .search-box.input-wrap:has(#searchInput:not(:placeholder-shown))::before {
  background-color: var(--search-icon-ink) !important;
  color: var(--search-icon-ink) !important;
  filter: none !important;
}

/* clear "x" button */
html[data-theme="dark"]
  #app-header
  .search-box.input-wrap:has(#searchInput:not(:placeholder-shown))
  .search-clear {
  color: var(--search-icon-ink) !important;
  opacity: 0.9;
}
