/* =============================================================================
   
   üìÅ STATUSBAR.CSS ‚Äî –ù–∏–∂–Ω–∏–π –±–∞—Ä
   
   –ß—Ç–æ –∑–¥–µ—Å—å:
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (#app-status)
   - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (.status-flex)
   - –ö–Ω–æ–ø–∫–∏ (theme, view switcher)
   - Save indicator (dot)
   - Responsive
   
   ============================================================================= */

/* –ü–æ–¥–ª–æ–∂–∫–∞ –ø–æ–¥ safe-area (–Ω–∞–≤–±–∞—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞) */
#app-status::after {
  content: "";
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  height: var(--safe-bottom);
  background: var(--header-bg);
  z-index: calc(var(--z-sticky) - 1);
  pointer-events: none;
}

#app-status {
  position: sticky;
  bottom: var(--safe-bottom);
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 4px 10px;
  background: var(--header-bg);
  color: var(--header-fg);
  border-top: 1px solid var(--header-border);
  white-space: nowrap;
  flex-wrap: nowrap;
  overflow: hidden;
  min-height: var(--statusbar-h);
  -webkit-overflow-scrolling: touch;
  scrollbar-gutter: stable both-edges;
  z-index: var(--z-sticky);
}

#app-status > * {
  flex: 0 0 auto;
}

/* === –°–ï–†–ï–î–ò–ù–ê –ë–ê–†–ê (–ø—Ä–æ–∫—Ä—É—Ç–∫–∞) === */
#app-status .status-flex {
  position: relative;
  flex: 1 1 auto;
  min-width: 0;
  display: flex;
  align-items: center;
  gap: var(--status-gap, 10px);
  overflow-x: auto;
  overflow-y: hidden;
  white-space: nowrap;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-x;
  cursor: grab;
}

#app-status .status-flex::-webkit-scrollbar {
  display: none;
}

/* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
#app-status .vsep {
  display: inline-block;
  width: 1px;
  height: 14px;
  background: var(--header-border);
  margin: 0 4px;
  flex: 0 0 1px;
}

/* –ò–º—è workspace: –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤, –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî —Ç—Ä–æ–µ—Ç–æ—á–∏–µ */
#app-status .status-flex .ws-name {
  min-width: 10ch;
  max-width: clamp(10ch, 45vw, 28ch);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 0 1 auto;
}

@media (max-width: 520px) {
  #app-status .status-flex .ws-name {
    max-width: clamp(10ch, 55vw, 32ch);
  }
}

/* === SAVE INDICATOR === */
#app-status .save-indicator {
  display: inline-flex;
  align-items: center;
  margin-right: 8px;
}

#app-status .save-indicator .dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid currentColor;
}

/* Saved: –ø—É—Å—Ç–æ–π –∫—Ä—É–∂–æ–∫; Dirty: –∑–∞–∫—Ä–∞—à–µ–Ω–Ω—ã–π —Å ¬´!¬ª */
#app-status .save-indicator[data-state="saved"] .dot {
  background: transparent;
}

#app-status .save-indicator[data-state="dirty"] .dot {
  background: currentColor;
  position: relative;
}

#app-status .save-indicator[data-state="dirty"] .dot::after {
  content: "!";
  position: absolute;
  inset: 0;
  font-size: 9px;
  line-height: 10px;
  text-align: center;
  font-weight: 700;
  color: var(--bg);
}

/* === –§–ï–ô–î–´ –ü–û –ö–†–ê–Ø–ú (–Ω–∞–º—ë–∫ ¬´–º–æ–∂–Ω–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—å¬ª) === */
#app-status .status-flex::before,
#app-status .status-flex::after {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  width: 16px;
  pointer-events: none;
  transition: opacity var(--dur-1) ease;
}

#app-status .status-flex::before {
  left: 0;
  background: linear-gradient(to right, var(--header-bg), transparent);
}

#app-status .status-flex::after {
  right: 0;
  background: linear-gradient(to left, var(--header-bg), transparent);
}

/* –ö—Ä–∞—è –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã ‚Äî –≥–∞—Å–∏–º —Ñ–µ–π–¥ */
#app-status .status-flex.at-start::before {
  opacity: 0;
}

#app-status .status-flex.at-end::after {
  opacity: 0;
}

/* === –ö–ù–û–ü–ö–ò === */
#app-status .status-theme-btn,
#app-status .status-view-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 8px;
  border: 1px solid var(--header-border);
  background: transparent;
  color: var(--header-fg);
  cursor: pointer;
}

#app-status .status-theme-btn:hover,
#app-status .status-view-btn:hover {
  background: color-mix(in oklab, var(--header-fg) 12%, transparent);
}

#app-status .status-view-btn .mi svg {
  width: 16px;
  height: 16px;
}

/* –ö–Ω–æ–ø–∫—É —Ç–µ–º—ã –ø—Ä–∏–∂–∏–º–∞–µ–º –≤–ø—Ä–∞–≤–æ */
#app-status .status-theme-btn {
  margin-left: auto;
  flex: 0 0 auto;
}

/* –°–≤–∏—Ç—á–µ—Ä Tiles/List –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º UI */
#app-status .status-view-btn {
  display: none;
}

body.study-overlay #app-status .status-view-btn,
body.compact-900 #app-status .status-view-btn {
  display: inline-flex;
}

@media (max-width: 900px) {
  #app-status .status-view-btn {
    display: inline-flex;
  }
}

/* === RESPONSIVE === */
@media (max-width: 640px) {
  #app-status {
    gap: 6px;
    padding-inline: 8px;
  }

  #app-status .status-flex {
    gap: 3px;
  }
}

@media (prefers-reduced-motion: reduce) {
  .save-indicator .dot {
    transition: none;
  }
}
